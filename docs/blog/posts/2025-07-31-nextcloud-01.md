---
date: 2025-07-31
categories:
  - HomeLab
tags:
  - Blog
  - Nextcloud
  - Cloudstorage
  - OpenOffice
---

# Hosting My Own **Nextcloud**: A Comprehensive Guide

Self-hosting Nextcloud can be both a cost-effective and privacy-focused approach to file syncing, online collaboration, and more. In this post, I will discuss how I set up a Nextcloud instance on a Proxmox virtual machine (VM) behind a Cloudflare Tunnel, leveraging my TrueNAS server for affordable, redundant storage. I will also walk through critical backup plans and ongoing maintenance strategies to keep everything secure and reliable.

<!-- more -->

---

## 1. Why I Chose Nextcloud

Nextcloud is an open-source solution that centralizes file sharing, syncing/back-up, calendar and contact management, and collaborative document editing. Unlike commercial cloud providers, I retain the advantage of full control over my own data.  
- **Privacy & Ownership**: All data resides in my infrastructure, so I set data-retention rules according to my preferences.  
- **Extensive Feature Set**: Beyond file hosting, Nextcloud offers integrated apps for office documents, chat, video calls, and more.  
- **Cost Savings**: Hosting on my own hardware eliminates monthly per-user cloud costs. I simply pay for hardware and energy usage.  

I already run a TrueNAS instance, so I can capitalize on its CIFS shares for large-capacity storage without ongoing fees from public cloud providers.

---

## 2. My Setup Overview

1. **Proxmox VM**: I created an Ubuntu 24 LTS VM on Proxmox to run Docker, where the Nextcloud AIO (All-In-One) container is deployed.  
2. **TrueNAS Storage**: My TrueNAS server provides SMB/CIFS shares, mounted directly on the VM to serve as Nextcloud’s main data directory.  
3. **Cloudflare Tunnel**: I rely on Cloudflare for DNS and a secure tunnel to expose Nextcloud publicly without opening direct ports on my home network. There is a slight caveat to this approach, however; For nextcloud talk to work correctly, we will have to either open a port or set up a turn-server, which I will cover in the up-coming blog.  
4. **Nextcloud AIO**: This image simplifies updates and maintenance by bundling the Nextcloud components (web server, database, etc.) into a cohesive Docker environment.

---

## 3. Step-by-Step: Getting Nextcloud Up and Running

### 3.1 Provision a Proxmox VM

1. **Create Ubuntu VM**  
   I prepared an Ubuntu 24 LTS vm with 4 CPU cores and 8 GB of RAM. This allocation should meet my need for the instance for hosting nextcloud for my family member and friends. This allocation ensures I can accommodate simultaneous file syncs and occasional group collaboration without any issues.  
2. **Provision Docker**  
   Follow the official guide [here](https://docs.docker.com/engine/install/ubuntu/)

### 3.2 Mount the TrueNAS Share

1. **Install cifs-utils**  
   ```bash
   sudo apt install cifs-utils -y
   ```
2. **Edit /etc/fstab**  
   I added entries to mount the TrueNAS share under `/mnt/prox-data-share` and linked it to my Nextcloud directory:
   ```text title="etc/fstab"
   # TrueNas instance ip address/data-share and mount location with credentials.
   //192.168.0.31/prox-data-share /mnt/prox-data-share cifs credentials=/root/smbcredentials,uid=1000,gid=1000,noauto,x-systemd.automount 0 0
   # Mount it to local nextcloud data directory as you will see in the following docker-compose file.
   /mnt/prox-data-share/nextcloud /home/johno/Docker/nextcloud none bind,nofail,errors=remount-ro 0 0
   ```
3. **Test the Mount**  
   ```bash
   sudo mount -a
   ls /mnt/prox-data-share
   ```
   If I see my files, the mount is successful.

### 3.3 Configure and Launch Nextcloud AIO

1. **Create docker-compose.yml**  
   In `/home/johno/Docker/nextcloud`, create Nextcloud AIO snippet:
   ```yaml
   services:
     nextcloud-aio-mastercontainer:
       image: nextcloud/all-in-one:latest
       init: true
       restart: unless-stopped
       container_name: nextcloud-aio-mastercontainer
       volumes:
         - nextcloud_aio_mastercontainer:/mnt/docker-aio-config # This line is not allowed to be changed as otherwise the built-in backup solution will not work
         - /var/run/docker.sock:/var/run/docker.sock:ro
       #ports:
       #  - 8080:8080 # uncomment this to accesss the nextcloud instance via host ip:port, I will be accessing directly via the domain and don't need to map this to the host.
       environment:
         - PUID=1000 # ensure to provide the id that has the permission to the required directories, including the SMB/CIFS share
         - PGID=1000
         - NEXTCLOUD_DATADIR=/home/Docker/nextcloud # Allows to set the host directory for Nextcloud's datadir. ⚠️⚠️⚠️ Warning: do not set or adjust this value after the initial Nextcloud installation is done! See https://github.com/nextcloud/all-in-one#how-to-change-the-default-location-of-nextclouds-datadir
         - APACHE_PORT=11000 # Is needed when running behind a web server or reverse proxy (like Apache, Nginx, Cloudflare Tunnel and else). See https://github.com/nextcloud/all-in-one/blob/main/reverse-proxy.md
         - APACHE_IP_BINDING=0.0.0.0 # Should be set when running behind a web server or reverse proxy (like Apache, Nginx, Cloudflare Tunnel and else) that is running on the same host. See https://github.com/nextcloud/all-in-one/blob/main/reverse-proxy.md
         - BORG_RETENTION_POLICY=--keep-within=7d --keep-weekly=4 --keep-monthly=6 # Allows to adjust borgs retention policy. See https://github.com/nextcloud/all-in-one#how-to-adjust-borgs-retention-policy
        # - TALK_PORT=3478 # This allows to adjust the port that the talk container is using. See https://github.com/nextcloud/all-in-one#how-to-adjust-the-talk-port
         - NEXTCLOUD_ENABLE_DRI_DEVICE=true # This allows to enable the /dev/dri device in the Nextcloud container. ⚠️⚠️⚠️ Warning: this only works if the '/dev/dri' device is present on the host! If it should not exist on your host, don't set this to true as otherwise the Nextcloud container will fail to start! See https://github.com/nextcloud/all-in-one#how-to-enable-hardware-transcoding-for-nextcloud

       networks:
         cloudflared-network:
           ipv4_address: 172.21.0.48 # I usually map all my instances with static address to avoid open port mapping on the host.

   networks:
     cloudflared-network:
       external: true

   volumes:
     nextcloud_aio_mastercontainer:
       name: nextcloud_aio_mastercontainer
   ```
2. **Start the Containers**  
   I launched the container:
   ```bash
   docker-compose up -d
   ```
3. **Confirm It’s Running**  
   ```bash
   docker logs -f nextcloud-aio-mastercontainer
   ```
   After a short wait, I see confirmation messages for successful start-up.

### 3.4 Integrate with Cloudflare Tunnel or Pangolin newt Tunnel.

1. This step requires minimal effort in setting up. [Cloudflared Document](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel/)

---

## 4. Creating My Admin User and Invitations

1. **Initial Login**  
   On first access, Nextcloud AIO setup will provide you with a Password (or passphrase), and you should write this down and store it safely. This is required for you to update and manage/orchestrate nextcloud containers. I store these credentials securely (for instance, in a password manager, `Vaultwarden`).  
2. **Initial Configuration**  
   As the administrator, you can now setup the nextcloud domain, backup location (which I've used another data-share on a different NAS location), and timezone, and etc.
3. **Let the journey begin**  
   - Once all of the containers' status shows green, meaning all downloaded and configured, you will be greeted with your initial username (`admin`) and initial password of which I recommend changing right away with 2FA setup right away. From here, you can start to the configuration of your SMTP service and other nextcloud setup, usually start by checking the admin menu to perform the nextcloud health checks. Most likely you will be greeted with some benign error messages that can be handled quite easily by following the nextcloud document.

---

## 5. Proper Backup Plan & Maintenance

Now that Nextcloud is live, I shift my focus to data protection. I rely on the built-in Nextcloud AIO backup feature, like **Borg** for off-site backups.

### 5.1 Proxmox built-in snapshots and back-up feature of the entire VM
1. **Snapshots**
   I don't know how many times the `snapshot` feature saved my skin when things went south. I usually have all my mission critical VMs configured on `ZFS` storage, which provides redundancy and nice features like live `snapshots`.
2. **VM Backup or FullClone**
   Another step I usually take is to create a full clone of the VM image periodically and store it as backup; in addition to performing incremental backups. Clones are more often than not used as templates for the VMs but it can also serve as a time-travel feature in most cases.
3. **Nextcloud built-in backup**
   Nextcloud uses [BorgBackup](https://borgbackup.readthedocs.io/en/stable/), which you ought to perform everytime when you want to update your nextcloud AIO master container and others. This is an incremental back-up solution, and I house these in a secure location on another NAS. This way you can revert back if the update process go south.

### 5.2 Alternatives
1. I always find some clients who are interested in their in-house `cloud` services, such as `NextCloud`, which more than often require a `VPS` or `VDS` that can host a combination of services. Setting up a `NextCloud` on a VPS/VDS is rather straight forward and easier to maintain than on your homelab environment (if you're not keen to open up your ports). However, creating an off-site backup requires more careful strategy. 
2. This is where the big cloud providers' cheap storage plans shine. For instance, `Google Cloud Storage` offers cheap storage plans like `Coldline` or `Archive` storage for dirt cheap rates, that the nextcloud can create the back-ups. Since these will be only required as a disaster-recovery scenarios, you may or maynot ever retrieve from these archives, and it cost only $0.0012 per GB/month for GCS Archive storage. That's like $6 per 5TB of storage. 
3. Why am I talking about the off-site back up plan for VPS/VDS hosted nextcloud? To list just one scenario ouf ot many: what happens the service provider ever go bankrupt? What happens to your data? This has happend before in our history and we should well-thought out back-up plans in such disastrous events.

---

## 7. Conclusion

Hosting my own Nextcloud has proven invaluable for consolidating file storage, collaboration, and user management under my control. By tapping into a TrueNAS share, I sidestep hefty cloud-stored data fees, and with Cloudflare Tunnels, I simplify remote access without broad firewall exposure. Most importantly, I maintain a robust backup infrastructure.

With these measures in place, I can confidently invite friends and family—providing them with `johnosoft.org` email addresses if desired—knowing my Nextcloud environment is secure, stable, and ready to grow. If I ever need to scale up resources, the Proxmox virtualization platform makes that a breeze. All in all, this approach balances convenience, cost, and control in a single, powerful setup.